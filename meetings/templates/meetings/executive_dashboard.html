{% extends 'meetings/base.html' %}

{% block title %}Executive Dashboard - TeamPulse AI{% endblock %}

{% block content %}

<!-- Header Section -->
<div class="mb-5">
    <div class="d-flex justify-content-between align-items-start mb-3 flex-wrap gap-3">
        <div>
            <h1 class="page-header mb-2">Team Intelligence Dashboard</h1>
            <p class="text-muted">AI-powered insights for healthier team collaboration</p>
        </div>
        <div class="text-end">
            <div class="d-flex gap-2 mb-2 flex-wrap justify-content-end">
                <div class="btn-group">
                    <button type="button" class="btn btn-outline-success dropdown-toggle" data-bs-toggle="dropdown">
                        üì• Export Reports
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'export_team_health_pdf' %}">üìÑ Team Health PDF</a></li>
                        <li><a class="dropdown-item" href="{% url 'export_team_health_excel' %}">üìä Team Health Excel</a></li>
                    </ul>
                </div>
                <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#emailDigestModal">
                    üìß Send Digest
                </button>
            </div>
            <div>
                <small class="text-muted d-block">Analyzing {{ total_meetings }} meeting{{ total_meetings|pluralize }}</small>
                <small class="text-muted">Last updated: {% now "M j, Y ‚Ä¢ g:i A" %}</small>
            </div>
        </div>
    </div>
</div>

<!-- Email Digest Modal -->
<div class="modal fade" id="emailDigestModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content" style="background: var(--bg-secondary); border: 1px solid var(--border-color);">
            <div class="modal-header" style="border-bottom: 1px solid var(--border-color);">
                <h5 class="modal-title" style="color: var(--text-primary);">Send Email Digest</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter: invert(1);"></button>
            </div>
            <form method="post" action="{% url 'send_email_digest' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Recipient Name</label>
                        <input type="text" name="name" class="form-control" placeholder="Team Lead" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email Address</label>
                        <input type="email" name="email" class="form-control" placeholder="leader@company.com" required>
                    </div>
                    <div class="alert alert-info" style="background: rgba(96, 165, 250, 0.1); border-color: rgba(96, 165, 250, 0.3); color: #93c5fd;">
                        <small>This will send a weekly team health summary including insights, risks, and recommendations.</small>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid var(--border-color);">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Send Email</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- AI Insight Banner -->
{% if ai_insight %}
<div class="alert mb-4" style="background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); border: none; border-radius: 16px; padding: 24px; box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3);">
    <div class="d-flex align-items-start gap-3">
        <div style="font-size: 2.5rem;">üß†</div>
        <div style="flex: 1;">
            <h5 class="mb-2" style="color: white; font-weight: 700;">AI Team Intelligence</h5>
            <p class="mb-2" style="color: rgba(255, 255, 255, 0.95); font-size: 1.05rem; line-height: 1.6;">
                {{ ai_insight.main_message }}
            </p>
            {% if ai_insight.primary_concern %}
            <div class="mt-3 p-3" style="background: rgba(255, 255, 255, 0.15); border-radius: 8px; border-left: 4px solid #fbbf24;">
                <strong style="color: #fef3c7;">‚ö†Ô∏è Primary Concern:</strong>
                <span style="color: white;">{{ ai_insight.primary_concern }}</span>
            </div>
            {% endif %}
            {% if ai_insight.recommended_focus %}
            <div class="mt-2 p-3" style="background: rgba(255, 255, 255, 0.15); border-radius: 8px; border-left: 4px solid #34d399;">
                <strong style="color: #d1fae5;">üí° Recommended Focus:</strong>
                <span style="color: white;">{{ ai_insight.recommended_focus }}</span>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}

<!-- Team Health Score - Hero Section -->
{% if health_index %}
<div class="card mb-4" style="background: linear-gradient(135deg, rgba(129, 140, 248, 0.1) 0%, rgba(99, 102, 241, 0.1) 100%); border: 2px solid rgba(129, 140, 248, 0.3);">
    <div class="card-body p-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <div class="d-flex align-items-center gap-3 mb-3">
                    <div style="font-size: 3rem;">{{ health_index.icon }}</div>
                    <div>
                        <h3 class="mb-1" style="color: var(--text-primary);">Team Health Score</h3>
                        <p class="text-muted mb-0">Overall collaboration health based on recent meetings</p>
                    </div>
                </div>
                <div class="alert alert-{{ health_index.color }} mb-0" style="background: rgba(129, 140, 248, 0.1); border-color: rgba(129, 140, 248, 0.3);">
                    <strong>Behavioral Summary:</strong><br>
                    {{ executive_summary }}
                </div>
            </div>
            <div class="col-md-4 text-center">
                <div class="position-relative d-inline-block">
                    <svg width="180" height="180" style="transform: rotate(-90deg);">
                        <circle cx="90" cy="90" r="70" fill="none" stroke="rgba(55, 65, 81, 0.3)" stroke-width="12"/>
                        <circle cx="90" cy="90" r="70" fill="none" 
                                stroke="{% if health_index.score >= 80 %}#34d399{% elif health_index.score >= 65 %}#60a5fa{% elif health_index.score >= 50 %}#fbbf24{% else %}#f87171{% endif %}" 
                                stroke-width="12"
                                stroke-dasharray="{% widthratio health_index.score 100 440 %} 440"
                                stroke-linecap="round"
                                style="transition: stroke-dasharray 1s ease;"/>
                    </svg>
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                        <h1 class="mb-0" style="font-size: 3rem; font-weight: 800; color: var(--text-primary);">{{ health_index.score|floatformat:0 }}</h1>
                        <small class="text-muted">/ 100</small>
                    </div>
                </div>
                <div class="mt-3">
                    <span class="badge bg-{{ health_index.color }} fs-6 px-4 py-2">{{ health_index.level|upper }}</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Top 3 Priorities Section - ENHANCED -->
{% if top_priorities %}
<div class="mb-5">
    <div class="d-flex align-items-center gap-3 mb-3">
        <h2 style="color: var(--text-primary); font-weight: 700; margin: 0;">üéØ Leadership Command Center</h2>
        <span class="badge bg-danger fs-6 px-3 py-2">{{ top_priorities|length }} Action{{ top_priorities|length|pluralize }} Required</span>
    </div>
    <p class="text-muted mb-4">AI-detected patterns requiring immediate leadership intervention</p>
    
    <div class="row g-3">
        {% for priority in top_priorities %}
        <div class="col-md-4">
            <div class="card h-100" style="border-left: 4px solid {% if priority.severity == 'Critical' %}#f87171{% elif priority.severity == 'High' %}#fbbf24{% else %}#60a5fa{% endif %}; transition: all 0.3s ease;">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <span class="badge bg-{% if priority.severity == 'Critical' %}danger{% elif priority.severity == 'High' %}warning{% else %}info{% endif %} fs-6">
                            #{{ priority.rank }} Priority
                        </span>
                        <span class="badge" style="background: rgba(248, 113, 113, 0.2); color: #fca5a5; border: 1px solid rgba(248, 113, 113, 0.4); font-size: 0.85rem;">
                            {{ priority.severity }}
                        </span>
                    </div>
                    <h5 class="mb-3" style="color: var(--text-primary); font-weight: 700;">{{ priority.title }}</h5>
                    
                    <div class="mb-3 p-3" style="background: rgba(96, 165, 250, 0.1); border-radius: 8px; border-left: 3px solid #60a5fa;">
                        <small style="color: var(--text-secondary); display: block; margin-bottom: 8px;"><strong>üîç What We Detected:</strong></small>
                        <p class="mb-0" style="font-size: 0.9rem; color: var(--text-primary);">{{ priority.description }}</p>
                    </div>
                    
                    <div class="alert alert-success mb-0" style="background: rgba(52, 211, 153, 0.1); border-color: rgba(52, 211, 153, 0.3); padding: 12px;">
                        <small style="display: block; margin-bottom: 4px;"><strong>üí° Leadership Action:</strong></small>
                        <small style="color: var(--text-primary);">{{ priority.action }}</small>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Key Metrics Grid - ENHANCED WITH TOOLTIPS -->
{% if trends %}
<div class="mb-5">
    <h2 class="mb-4" style="color: var(--text-primary); font-weight: 700;">üìä Continuous Team Intelligence</h2>
    
    <div class="row g-4">
        <!-- Sentiment Metric -->
        <div class="col-md-6 col-lg-3">
            <div class="card h-100" style="transition: all 0.3s ease; cursor: help;" 
                 data-bs-toggle="tooltip" 
                 data-bs-placement="top" 
                 data-bs-html="true"
                 title="<strong>Team Sentiment</strong><br>Measures positivity vs negativity in team communication. Tracks whether discussions are collaborative and constructive or showing frustration.">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div style="font-size: 2rem;">üí≠</div>
                        <span class="badge bg-{% if trends.sentiment.trend == 'improving' %}success{% elif trends.sentiment.trend == 'declining' %}danger{% else %}secondary{% endif %}">
                            {% if trends.sentiment.trend == 'improving' %}‚ÜóÔ∏è{% elif trends.sentiment.trend == 'declining' %}‚ÜòÔ∏è{% else %}‚Üí{% endif %}
                            {{ trends.sentiment.change_percentage|floatformat:1 }}%
                        </span>
                    </div>
                    <h6 class="text-muted mb-2">Team Sentiment</h6>
                    <h3 class="mb-3" style="color: var(--text-primary);">
                        {% if trends.sentiment.current_avg > 0.2 %}Positive{% elif trends.sentiment.current_avg < -0.1 %}Negative{% else %}Neutral{% endif %}
                    </h3>
                    <div class="progress mb-2" style="height: 6px;">
                        <div class="progress-bar bg-{% if trends.sentiment.current_avg > 0.2 %}success{% elif trends.sentiment.current_avg < -0.1 %}danger{% else %}info{% endif %}" 
                             style="width: {% widthratio trends.sentiment.current_avg|add:1 2 100 %}%;">
                        </div>
                    </div>
                    <small class="text-muted">Score: {{ trends.sentiment.current_avg|floatformat:2 }}</small>
                    <hr style="border-color: var(--border-color); margin: 12px 0;">
                    <small class="text-secondary">
                        <strong>Status:</strong> 
                        <span class="text-{% if trends.sentiment.trend == 'improving' %}success{% elif trends.sentiment.trend == 'declining' %}danger{% else %}muted{% endif %}">
                            {% if trends.sentiment.trend == 'improving' %}Healthy{% elif trends.sentiment.trend == 'declining' %}Needs Attention{% else %}Stable{% endif %}
                        </span>
                    </small>
                </div>
            </div>
        </div>

        <!-- Participation Metric -->
        <div class="col-md-6 col-lg-3">
            <div class="card h-100" style="transition: all 0.3s ease; cursor: help;"
                 data-bs-toggle="tooltip" 
                 data-bs-placement="top" 
                 data-bs-html="true"
                 title="<strong>Participation Balance</strong><br>Measures how evenly conversation is distributed. Low scores indicate dominance by a few voices, potentially silencing others.">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div style="font-size: 2rem;">üéØ</div>
                        <span class="badge bg-{% if trends.participation.trend == 'improving' %}success{% elif trends.participation.trend == 'declining' %}danger{% else %}secondary{% endif %}">
                            {% if trends.participation.trend == 'improving' %}‚ÜóÔ∏è{% elif trends.participation.trend == 'declining' %}‚ÜòÔ∏è{% else %}‚Üí{% endif %}
                            {{ trends.participation.change_percentage|floatformat:1 }}%
                        </span>
                    </div>
                    <h6 class="text-muted mb-2">Participation Balance</h6>
                    <h3 class="mb-3" style="color: var(--text-primary);">
                        {% if trends.participation.current_balance > 0.65 %}Balanced{% elif trends.participation.current_balance < 0.4 %}Imbalanced{% else %}Moderate{% endif %}
                    </h3>
                    <div class="progress mb-2" style="height: 6px;">
                        <div class="progress-bar bg-{% if trends.participation.current_balance > 0.65 %}success{% elif trends.participation.current_balance < 0.4 %}danger{% else %}warning{% endif %}" 
                             style="width: {% widthratio trends.participation.current_balance 1 100 %}%;">
                        </div>
                    </div>
                    <small class="text-muted">Score: {{ trends.participation.current_balance|floatformat:2 }}</small>
                    <hr style="border-color: var(--border-color); margin: 12px 0;">
                    <small class="text-secondary">
                        <strong>Status:</strong> 
                        <span class="text-{% if trends.participation.current_balance > 0.65 %}success{% elif trends.participation.current_balance < 0.4 %}danger{% else %}warning{% endif %}">
                            {% if trends.participation.current_balance > 0.65 %}Healthy{% elif trends.participation.current_balance < 0.4 %}At Risk{% else %}Needs Attention{% endif %}
                        </span>
                    </small>
                </div>
            </div>
        </div>

        <!-- Engagement Metric -->
        <div class="col-md-6 col-lg-3">
            <div class="card h-100" style="transition: all 0.3s ease; cursor: help;"
                 data-bs-toggle="tooltip" 
                 data-bs-placement="top" 
                 data-bs-html="true"
                 title="<strong>Team Engagement</strong><br>Measures active participation quality through message length, questions, and interaction frequency. Low engagement suggests disinterest or fatigue.">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div style="font-size: 2rem;">‚ö°</div>
                        <span class="badge bg-{% if trends.engagement.trend == 'improving' %}success{% elif trends.engagement.trend == 'declining' %}danger{% else %}secondary{% endif %}">
                            {% if trends.engagement.trend == 'improving' %}‚ÜóÔ∏è{% elif trends.engagement.trend == 'declining' %}‚ÜòÔ∏è{% else %}‚Üí{% endif %}
                            {{ trends.engagement.change_percentage|floatformat:1 }}%
                        </span>
                    </div>
                    <h6 class="text-muted mb-2">Team Engagement</h6>
                    <h3 class="mb-3" style="color: var(--text-primary);">
                        {% if trends.engagement.current_avg > 65 %}High{% elif trends.engagement.current_avg < 40 %}Low{% else %}Moderate{% endif %}
                    </h3>
                    <div class="progress mb-2" style="height: 6px;">
                        <div class="progress-bar bg-{% if trends.engagement.current_avg > 65 %}success{% elif trends.engagement.current_avg < 40 %}danger{% else %}warning{% endif %}" 
                             style="width: {{ trends.engagement.current_avg }}%;">
                        </div>
                    </div>
                    <small class="text-muted">Score: {{ trends.engagement.current_avg|floatformat:0 }}/100</small>
                    <hr style="border-color: var(--border-color); margin: 12px 0;">
                    <small class="text-secondary">
                        <strong>Status:</strong> 
                        <span class="text-{% if trends.engagement.current_avg > 65 %}success{% elif trends.engagement.current_avg < 40 %}danger{% else %}warning{% endif %}">
                            {% if trends.engagement.current_avg > 65 %}Healthy{% elif trends.engagement.current_avg < 40 %}At Risk{% else %}Needs Attention{% endif %}
                        </span>
                    </small>
                </div>
            </div>
        </div>

        <!-- Communication Volume Metric -->
        <div class="col-md-6 col-lg-3">
            <div class="card h-100" style="transition: all 0.3s ease; cursor: help;"
                 data-bs-toggle="tooltip" 
                 data-bs-placement="top" 
                 data-bs-html="true"
                 title="<strong>Communication Volume</strong><br>Tracks message frequency trends. Declining volume may indicate disengagement; excessive increases might signal chaos or lack of clarity.">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div style="font-size: 2rem;">üí¨</div>
                        <span class="badge bg-{% if trends.message_volume.trend == 'stable' %}success{% elif trends.message_volume.trend == 'decreasing' %}danger{% else %}info{% endif %}">
                            {% if trends.message_volume.trend == 'increasing' %}‚ÜóÔ∏è{% elif trends.message_volume.trend == 'decreasing' %}‚ÜòÔ∏è{% else %}‚Üí{% endif %}
                            {{ trends.message_volume.change_percentage|floatformat:1 }}%
                        </span>
                    </div>
                    <h6 class="text-muted mb-2">Communication Volume</h6>
                    <h3 class="mb-3" style="color: var(--text-primary);">
                        {{ trends.message_volume.trend|title }}
                    </h3>
                    <div class="progress mb-2" style="height: 6px;">
                        <div class="progress-bar bg-{% if trends.message_volume.trend == 'stable' %}success{% elif trends.message_volume.trend == 'decreasing' %}danger{% else %}info{% endif %}" 
                             style="width: 70%;">
                        </div>
                    </div>
                    <small class="text-muted">Avg: {{ trends.message_volume.current_avg|floatformat:0 }} msgs/meeting</small>
                    <hr style="border-color: var(--border-color); margin: 12px 0;">
                    <small class="text-secondary">
                        <strong>Status:</strong> 
                        <span class="text-{% if trends.message_volume.trend == 'stable' %}success{% elif trends.message_volume.trend == 'decreasing' %}danger{% else %}muted{% endif %}">
                            {% if trends.message_volume.trend == 'stable' %}Healthy{% elif trends.message_volume.trend == 'decreasing' %}Needs Attention{% else %}Normal{% endif %}
                        </span>
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- AI Insights Section -->
<div class="row g-4 mb-5">
    <!-- Key Strengths -->
    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0">‚úÖ Key Strengths</h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-3">Positive collaboration patterns identified</p>
                {% if key_strengths %}
                <ul class="list-unstyled mb-0">
                    {% for strength in key_strengths %}
                    <li class="mb-3">
                        <div class="d-flex gap-2">
                            <div class="text-success" style="font-size: 1.2rem;">‚úì</div>
                            <div>
                                <p class="mb-0" style="color: var(--text-primary);">{{ strength }}</p>
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted mb-0">Upload more meetings to identify team strengths</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Primary Risks -->
    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0">‚ö†Ô∏è Primary Risks</h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-3">Potential collaboration challenges detected</p>
                {% if primary_risks %}
                <div class="accordion" id="risksAccordion">
                    {% for risk in primary_risks %}
                    <div class="accordion-item" style="background: var(--bg-tertiary); border: 1px solid var(--border-color); margin-bottom: 10px; border-radius: 8px;">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#risk{{ forloop.counter }}" style="background: var(--bg-tertiary); color: var(--text-primary); border-radius: 8px;">
                                <div class="d-flex justify-content-between align-items-center w-100 pe-3">
                                    <span><strong>{{ risk.type }}</strong></span>
                                    <span class="badge bg-{{ risk.level }}">{{ risk.level|upper }}</span>
                                </div>
                            </button>
                        </h2>
                        <div id="risk{{ forloop.counter }}" class="accordion-collapse collapse" data-bs-parent="#risksAccordion">
                            <div class="accordion-body">
                                <p class="mb-2"><strong>What's happening:</strong> {{ risk.explanation }}</p>
                                <p class="mb-0 text-muted"><strong>Potential impact:</strong> {{ risk.impact }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted mb-0">No significant risks detected. Keep monitoring team dynamics.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Recommended Actions -->
{% if recommended_actions %}
<div class="mb-5">
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">üí° AI Leadership Coaching</h5>
        </div>
        <div class="card-body">
            <p class="text-muted mb-4">Context-aware recommendations to strengthen team collaboration</p>
            
            <div class="row g-3">
                {% for action in recommended_actions %}
                <div class="col-md-6">
                    <div class="card" style="background: rgba(129, 140, 248, 0.05); border: 1px solid rgba(129, 140, 248, 0.2);">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <span class="badge bg-{% if action.priority == 'Critical' %}danger{% elif action.priority == 'High' %}warning{% else %}info{% endif %}">
                                    {{ action.priority }} Priority
                                </span>
                            </div>
                            <h6 class="mb-2" style="color: var(--text-primary);">{{ action.action }}</h6>
                            <p class="text-secondary mb-2" style="font-size: 0.85rem;"><strong>Why:</strong> {{ action.reason }}</p>
                            <p class="text-muted mb-0" style="font-size: 0.85rem;"><strong>Expected impact:</strong> {{ action.expected_impact }}</p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Recent Meetings Summary -->
<div class="card">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">üìÖ Recent Meetings</h5>
            <a href="{% url 'meeting_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
        </div>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Meeting</th>
                        <th>Date</th>
                        <th>Sentiment</th>
                        <th>Balance</th>
                        <th>Messages</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for meeting in meetings %}
                    <tr>
                        <td><strong>{{ meeting.title }}</strong></td>
                        <td>{{ meeting.date|date:"M j, Y" }}</td>
                        <td>
                            <span class="sentiment-badge sentiment-{{ meeting.sentiment_label }}">
                                {{ meeting.avg_sentiment|floatformat:2 }}
                            </span>
                        </td>
                        <td>{{ meeting.participation_balance|floatformat:2 }}</td>
                        <td>{{ meeting.total_messages }}</td>
                        <td>
                            <a href="{% url 'meeting_dashboard' meeting.pk %}" class="btn btn-sm btn-outline-primary">
                                Details
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize Bootstrap tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl, {
                html: true,
                delay: { show: 300, hide: 100 }
            })
        });
        
        // Smooth fade-in animation for cards
        const cards = document.querySelectorAll('.card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 50);
        });

        // Enhanced card hover effect for metric cards
        const metricCards = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        metricCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-8px) scale(1.02)';
                this.style.boxShadow = '0 12px 24px rgba(0, 0, 0, 0.4)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
                this.style.boxShadow = '';
            });
        });
    });
</script>
{% endblock %}
